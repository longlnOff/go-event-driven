# Project: Adding query params for the Read Model endpoint

{{background}}

The frontend team prepared the frontend for our API, and the operations team is delighted with the new dashboard.
They just need to have one extra feature.
The finance team wants to be able to search for bookings by the receipt issue date, 
so they can double-check the data before sending it to the tax office.

Did we already mention that we shouldn't mess with our finance team? 
Let's implement this before they block our salary transfer. 

{{endbackground}}

Read models are excellent in case when we need to provide the search or filtering capabilities.
Especially at scale and on multiple fields that are potentially generated by multiple domains.

Some companies, decide to use GraphQL for such purposes.
But once you already have a proper read model in place, it's much easier to achieve the same with a REST API.
It's also faster in terms of performance and simpler to implement.

Let's do a simple exercise and add a query param to our endpoint.

## Exercise

Exercise path: ./project

1. In the `GET /ops/bookings` endpoint, add a query param: `receipt_issue_date`.

It should accept a date in the `YYYY-MM-DD` format.

2. Update the database query that returns all bookings to filter by this date.

If *any* ticket in a booking has the receipt issued at the given date, the booking should be returned.

{{hints}}

{{hint 1}}

We prepared an example query for you:

```sql
WHERE booking_id IN (
    SELECT booking_id FROM (
        SELECT booking_id, 
            DATE(jsonb_path_query(payload, '$.tickets.*.receipt_issued_at')::text) as receipt_issued_at 
        FROM 
            read_model_ops_bookings
    ) bookings_within_date 
    WHERE receipt_issued_at = $1
)
```

It's not the most efficient query, but it's good enough for our purposes.
If you want an extra exercise, you can try to optimize it.

Of course, it would be much simpler to implement with a database that was designed for search and storing documents,
like Elasticsearch or MongoDB.

{{endhint}}

{{endhints}}
